import java.util.Arrays;

public class StockBuySellWithCoolDown {

    private static int maxProfit(int[] prices, int curDay, int boughtIndex, int[][] maxProfitDP) {
        System.out.println("Current day: " + curDay);
        int n = prices.length;
        if (curDay >= n) {
            System.out.println("curDay>=n.  Returning 0");
            return 0;
        }

        if (boughtIndex != -1 && maxProfitDP[curDay][boughtIndex] != -1) {
            System.out.println("DP hit.  Returning " + maxProfitDP[curDay][boughtIndex]);
            return maxProfitDP[curDay][boughtIndex];
        }

        int profitWhenBoughtToday = 0;
        int profitWhenSoldToday = 0;
        if (boughtIndex == -1) {
            System.out.println("buying day: " + curDay);
            profitWhenBoughtToday = maxProfit(prices, curDay+1, curDay, maxProfitDP);
        }
        else {
            if (prices[curDay] - prices[boughtIndex] > 0) {
                System.out.println("selling day: " + curDay);
                profitWhenSoldToday = (prices[curDay] - prices[boughtIndex]) + maxProfit(prices,
                    curDay + 2,
                    -1,
                    maxProfitDP);
            }
        }

        int profitWhenNoTransactionDone = maxProfit(prices, curDay+1, boughtIndex, maxProfitDP);

        int maxProfitAtCurDay = Math.max(Math.max(profitWhenBoughtToday, profitWhenSoldToday),
            profitWhenNoTransactionDone);
        if (boughtIndex != -1) {
            maxProfitDP[curDay][boughtIndex] = maxProfitAtCurDay;
        }
        System.out.println("Finish curDay: " + curDay + " Returning: " + maxProfitAtCurDay);
        return maxProfitAtCurDay;
    }

    public static int maxProfit(int[] prices) {
        int maxProfitDP[][] = new int[prices.length][prices.length];
        Arrays.stream(maxProfitDP).forEach(a -> Arrays.fill(a, -1));
        return maxProfit(prices, 0, -1, maxProfitDP);
    }

    public static void main(String[] args) {
        int[] prices = {
            106,
            373,
            495,
            46,
            359,
            919,
            906,
            440,
            783,
            583,
            784,
            73,
            238,
            701,
            972,
            308,
            165,
            774,
            990,
            675,
            737,
            990,
            713,
            157,
            211,
            880,
            961,
            132,
            980,
            136,
            285,
            239,
            628,
            221,
            948,
            939,
            28,
            541,
            414,
            180,
            171,
            640,
            297,
            873,
            59,
            814,
            832,
            611,
            868,
            633,
            101,
            67,
            396,
            264,
            445,
            548,
            257,
            656,
            624,
            71,
            607,
            67,
            836,
            14,
            373,
            205,
            434,
            203,
            661,
            793,
            45,
            623,
            140,
            67,
            177,
            885,
            155,
            764,
            363,
            269,
            599,
            32,
            228,
            111,
            102,
            565,
            918,
            592,
            604,
            244,
            982,
            533,
            781,
            604,
            115,
            429,
            33,
            894,
            778,
            885,
            145,
            888,
            577,
            275,
            644,
            824,
            277,
            302,
            182,
            94,
            479,
            563,
            52,
            771,
            544,
            794,
            964,
            827,
            744,
            366,
            548,
            761,
            477,
            434,
            999,
            86,
            1000,
            5,
            99,
            311,
            346,
            609,
            778,
            937,
            372,
            793,
            754,
            191,
            592,
            860,
            748,
            297,
            610,
            386,
            146,
            220,
            7,
            113,
            657,
            438,
            482,
            700,
            158,
            884,
            877,
            964,
            777,
            139,
            809,
            489,
            383,
            92,
            581,
            970,
            899,
            947,
            864,
            443,
            490,
            825,
            674,
            906,
            402,
            270,
            416,
            611,
            949,
            476,
            775,
            899,
            837,
            796,
            227,
            232,
            226,
            11,
            266,
            889,
            215,
            6,
            182,
            430,
            5,
            706,
            994,
            128,
            359,
            841,
            439,
            263,
            491,
            689,
            638,
            485,
            763,
            695,
            135,
            800,
            763,
            54,
            569,
            387,
            112,
            316,
            193,
            675,
            546,
            531,
            954,
            571,
            208,
            282,
            557,
            892,
            469,
            875,
            765,
            592,
            374,
            276,
            892,
            843,
            625,
            180,
            249,
            292,
            477,
            882,
            837,
            112,
            46,
            667,
            187,
            93,
            418,
            790,
            903,
            12,
            978,
            510,
            647,
            446,
            597,
            958,
            678,
            897,
            420,
            907,
            256,
            170,
            669,
            920,
            711,
            635,
            995,
            259,
            994,
            634,
            583,
            175,
            380,
            435,
            942,
            739,
            921,
            132,
            455,
            986,
            567,
            464,
            301,
            10,
            579,
            84,
            745,
            717,
            588,
            414,
            375,
            319,
            770,
            310,
            510,
            521,
            88,
            445,
            59,
            460,
            120,
            765,
            480,
            441,
            169,
            374,
            180,
            947,
            179,
            346,
            490,
            417,
            149,
            140,
            577,
            624,
            427,
            238,
            341,
            686,
            623,
            228,
            672,
            859,
            372,
            938,
            567,
            141,
            133,
            671,
            255,
            997,
            272,
            591,
            115,
            340,
            692,
            531,
            235,
            123,
            677,
            980,
            31,
            774,
            135,
            194,
            956,
            723,
            779,
            375,
            546,
            59,
            695,
            616,
            416,
            362,
            38,
            145,
            782,
            184,
            418,
            806,
            444,
            177,
            360,
            485,
            941,
            998,
            85,
            840,
            740,
            545,
            49,
            570,
            17,
            824,
            845,
            749,
            177,
            727,
            238,
            656,
            787,
            425,
            473,
            323,
            683,
            578,
            442,
            436,
            444,
            595,
            367,
            44,
            467,
            93,
            507,
            949,
            598,
            579,
            471,
            1,
            347,
            982,
            232,
            878,
            217,
            845,
            777,
            284,
            527,
            529,
            100,
            482,
            456,
            814,
            457,
            251,
            494,
            419,
            922,
            139,
            706,
            384,
            954,
            365,
            680,
            70,
            810,
            764,
            820,
            992,
            622,
            29,
            697,
            294,
            553,
            655,
            63,
            934,
            827,
            157,
            680,
            812,
            729,
            486,
            403,
            151,
            988,
            926,
            460,
            193,
            294,
            423,
            774,
            715,
            906,
            957,
            598,
            929,
            339,
            119,
            686,
            88,
            228,
            803,
            806,
            743,
            430,
            315,
            224,
};
        System.out.println(maxProfit(prices));
    }

    void utilStatements() {
        System.out.println();
    }

}
